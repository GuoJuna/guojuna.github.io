(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{604:function(a,t,s){"use strict";s.r(t);var e=s(0),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),t("p",[a._v("Elasticsearch是一个基于Apache Lucene(TM)的开源搜索引擎。无论在开源还是专有领域，Lucene可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。\n特点：")]),a._v(" "),t("ul",[t("li",[a._v("分布式的实时文件存储，每个字段都被索引并可被搜索")]),a._v(" "),t("li",[a._v("分布式的实时分析搜索引擎--做不规则查询")]),a._v(" "),t("li",[a._v("可以扩展到上百台服务器，处理PB级结构化或非结构化数据\nElasticsearch也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂性，从而让全文搜索变得简单。")])]),a._v(" "),t("p",[a._v("ES能做什么？"),t("br"),a._v("\n全文检索（全部字段）、模糊查询（搜索）、数据分析（提供分析语法，例如聚合）")]),a._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),t("ol",[t("li",[a._v("下载镜像")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker pull elasticsearch7.4.2   \ndocker pull kibana:7.4.2\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("创建实例")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('mkdir -p /mydata/elasticsearch/config\nmkdir -p /mydata/elasticsearch/data\necho "http.host: 0.0.0.0">>/mydata/elasticsearch/config/elasticsearch.yml\n\ndocker run --name elasticsearch -p 9200:9200 -p 9300:9300 \\\n-e "discovery.type=single-node" \\\n-e ES_JAVA_OPTS="-Xms64m -Xmx128m" \\\n-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml \\\n-v /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins \\\n-d elasticsearch:7.4.2\n\n## -e ES_JAVA_OPTS="-Xms64m -Xmx128m" 测试环境下设置ES的初始内存和最大内存,否则导致过大启动不了ES\n')])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("查看日志")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker logs elasticsearch\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[a._v("安装Kibana")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker run --name kibana -e ELASTICSEARCH_HOSTS=http://192.168.56.20:9200 -p 5601:5601 \\\n-d kibana:7.4.2\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[a._v("查看日志")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker logs kibana\n")])])]),t("ol",{attrs:{start:"6"}},[t("li",[a._v("访问可视化页面")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("http://192.168.56.20:5601/\n")])])]),t("h2",{attrs:{id:"初始检索"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始检索"}},[a._v("#")]),a._v(" 初始检索")]),a._v(" "),t("ol",[t("li",[a._v("_cat")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("GET /_cat/nodes  查看所有节点\nGET /_cat/health 查看es健康状况\nGET /_cat/master 查看主节点\nGET /_cat/indices 查看所有索引\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("索引一个文档(保存)\n保存一个数据,保存在哪个索引的哪个类型下,指定用哪个唯一标识"),t("br"),a._v("\nPUT customer/external/1  在custoemr索引下的external类型下保存1号数据为:")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('PUT customer/external/1\n\n{\n    "name":"小明"\n}\n')])])]),t("p",[a._v("PUT和POST都可以"),t("br"),a._v("\nPOST新增,如果不指定id,会自动生成id. 指定id就会修改这个数据,并新增版本号")]),a._v(" "),t("p",[a._v("PUT可以新增可以修改,PUT必须指定id,由于PUT需要指定id,我们一般都用来修改操作,不指定id会报错")]),a._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[a._v("查询文档")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("GET customer/external/1\n")])])]),t("p",[a._v("结果:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{\n    "_index":"customer", //在哪个索引\n    "_typpe":"external", //在哪个类型\n    "_id":"1",           //记录id\n    "_version":2,        //版本号\n    "_seq_no":1,         //并发控制字段,每次更新就会+1,用来做乐观锁\n    "_primary_term":1,   //同上,主分片重新分配,如重启,就会变化\n    "found":true,\n    "_source":{\n        "name":"小明 "\n    }\n}\n')])])]),t("ol",{attrs:{start:"4"}},[t("li",[a._v("更新文档")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('POST customer/external/1/_update\n{\n    "doc":{\n        "name":"小明"\n    }\n}\n或者\nPOST customer/external/1\n{\n    "name":"小明"\n}\n')])])]),t("ol",{attrs:{start:"5"}},[t("li",[a._v("删除文档&索引")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("DELETE customer/external/1\nDELETE customer\n")])])]),t("ol",{attrs:{start:"6"}},[t("li",[a._v("bulk批量API")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('POST customer/external/_bulk\n{"index":{"_id":"1"}}\n{"name":"小明"}\n{"index":{"_id":"2"}}\n{"name":"小王"}\n')])])]),t("h2",{attrs:{id:"进阶检索"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进阶检索"}},[a._v("#")]),a._v(" 进阶检索")]),a._v(" "),t("ol",[t("li",[a._v("SearchAPI\nES支持两种基本方式检索:")])]),a._v(" "),t("ul",[t("li",[a._v("一个是通过使用REST request URI 发送搜索参数(uri+检索参数)")]),a._v(" "),t("li",[a._v("另一个是通过REST request body 来发送它们(uri+请求体)")])]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[a._v("Query DSL")])]),a._v(" "),t("li",[t("p",[a._v("Mapping")])]),a._v(" "),t("li",[t("p",[a._v("分词\n安装ik分词")])])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("// 1.下载ik分词\nwget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.4.2/elasticsearch-analysis-ik-7.4.2.zip\n// 2. 进入/mydata/elasticsearch/plugins目录\ncd /mydata/elasticsearch/plugins\n// 3. 创建ik目录\nmkdir ik\n// 4. 解压elasticsearch-analysis-ik-7.4.2.zip\nunzip elasticsearch-analysis-ik-7.4.2.zip\n// 进入docker容器查看插件 \ndocker exec -it 124 /bin/bash\ncd bin\nelasticsearch-plugin list\n")])])]),t("h2",{attrs:{id:"springdata-elasticsearch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#springdata-elasticsearch"}},[a._v("#")]),a._v(" SpringData-Elasticsearch")])])}),[],!1,null,null,null);t.default=r.exports}}]);