(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{582:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"配置tomcat证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置tomcat证书"}},[t._v("#")]),t._v(" 配置Tomcat证书")]),t._v(" "),s("ol",[s("li",[t._v("复制证书到resources文件夹下")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gj-blog.oss-cn-hangzhou.aliyuncs.com/blog-img/2020/08/20200828160710.png",alt:"image-20200828160703760"}})]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("配置application.yml添加server中https配置")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tomcat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri-encoding")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UTF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-threads")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-spare-threads")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ssl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key-store")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" classpath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("public/admin.yh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("future.com.pfx   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 配置路径")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key-store-password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 11z5NS62                          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 配置密码           ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keyStoreType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PKCS12\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connection-timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5000ms\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servlet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("session")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http-only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("h2",{attrs:{id:"配置nginx证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx证书"}},[t._v("#")]),t._v(" 配置Nginx证书")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("复制证书到nginx/cert目录")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gj-blog.oss-cn-hangzhou.aliyuncs.com/blog-img/2020/08/20200828160956.png",alt:"image-20200828160956050"}})])]),t._v(" "),s("li",[s("p",[t._v("配置nginx.conf文件")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#以下属性中以ssl开头的属性代表与证书配置有关，其他属性请根据自己的需要进行配置。")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         listen 443; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置HTTPS的默认访问端口号为443。此处如果未配置HTTPS的默认访问端口，可能会造成Nginx无法启动。Nginx 1.15.0以上版本请使用listen 443 ssl代替listen 443和ssl on。")]),t._v("\n         server_name www.certificatestests.com; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将www.certificatestests.com修改为您证书绑定的域名，例如：www.example.com。如果您购买的是通配符域名证书，要修改为通配符域名，例如：*.aliyun.com。")]),t._v("\n         root html;\n         index index.html index.htm;\n         ssl_certificate cert/domain name.pem;  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将domain name.pem替换成您证书的文件名称。")]),t._v("\n         ssl_certificate_key cert/domain name.key; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将domain name.key替换成您证书的密钥文件名称。")]),t._v("\n         ssl_session_timeout 5m;\n         ssl_ciphers ECDHE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("RSA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("AES128"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("GCM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("SHA256"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ECDHE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ECDH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("AES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("HIGH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!NULL:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!aNULL:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!MD5:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!ADH:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!RC4;")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用此加密套件。")]),t._v("\n         ssl_protocols TLSv1 TLSv1.1 TLSv1.2; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用该协议进行配置。")]),t._v("\n         ssl_prefer_server_ciphers on;\n         location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         root html;  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#站点目录。")]),t._v("\n         index index.html index.htm;\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("重启Nginx")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("./nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查配置")]),t._v("\n./nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("s reload  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启Nginx服务器")]),t._v("\n")])])]),s("h2",{attrs:{id:"配置nginx中http自动转https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx中http自动转https"}},[t._v("#")]),t._v(" 配置Nginx中Http自动转Https")]),t._v(" "),s("ol",[s("li",[t._v("通过Nginx利用497配置http跳转到https")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("error_page 497 https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$server_port$uri$is_args$args;\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("完整Nginx配置")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       8001 ssl;\n        \n        server_name  localhost;\n        root   /project/system/frontend/dist/;\n        \n        ssl_certificate  /usr/local/nginx/cert/admin.yh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("future.com.pem;\n        ssl_certificate_key /usr/local/nginx/cert/admin.yh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("future.com.key;\n        ssl_session_timeout 5m;\n        ssl_ciphers ECDHE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("RSA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("AES128"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("GCM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("SHA256"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ECDHE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ECDH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("AES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("HIGH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!NULL:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!aNULL:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!MD5:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!ADH:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!RC4;")]),t._v("\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_prefer_server_ciphers on;\n\n        error_page 497 https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$server_port$uri$is_args$args;\n\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html;\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_80端口转发到https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_80端口转发到https"}},[t._v("#")]),t._v(" 80端口转发到https")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http节点中可以添加多个server节点")]),t._v("\n    server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ssl 需要监听443端口")]),t._v("\n        listen 443;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CA证书对应的域名")]),t._v("\n        server_name zhihao.free.idcfengye.com;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启ssl")]),t._v("\n        ssl on;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器证书绝对路径")]),t._v("\n        ssl_certificate /etc/ssl/cert_felord.cn.crt;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器端证书key绝对路径 ")]),t._v("\n        ssl_certificate_key /etc/ssl/cert_felord.cn.key;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# session超时")]),t._v("\n        ssl_session_timeout 5m;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 协议类型")]),t._v("\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssl算法列表 ")]),t._v("\n        ssl_ciphers ECDHE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("RSA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("AES128"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("GCM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("SHA256"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("HIGH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!aNULL:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!MD5:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!RC4:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!DHE;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  是否 服务器决定使用哪种算法  on/off   TLSv1.1 的话需要开启")]),t._v("\n        ssl_prefer_server_ciphers on;\n        \n        location ^~  /zhihao/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_set_header Host $host;\n            proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8080/;\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果用户通过 http 访问 直接重写 跳转到 https 这个是一个很有必要的操作")]),t._v("\n    server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 80;\n        server_name zhihao.free.idcfengye.com;\n        rewrite ^/(."),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*)$")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//zhihao.free.idcfengye.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("443/$1 permanent;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);