(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{605:function(e,t,a){"use strict";a.r(t);var s=a(0),n=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),t("p",[e._v("Kubernetes是Google 2014年创建管理的，是Google 10多年大规模容器管理技术Borg的开源版本。它是容器集群管理系统，是一个开源的平台，可以实现容器集群的自动化部署、自动扩缩容、维护等功能。")]),e._v(" "),t("p",[e._v("通过Kubernetes你可以：")]),e._v(" "),t("ul",[t("li",[e._v("快速部署应用")]),e._v(" "),t("li",[e._v("快速扩展应用")]),e._v(" "),t("li",[e._v("无缝对接新的应用功能")]),e._v(" "),t("li",[e._v("节省资源，优化硬件资源的使用")])]),e._v(" "),t("p",[e._v("Kubernetes 特点:")]),e._v(" "),t("ul",[t("li",[e._v("可移植: 支持公有云，私有云，混合云，多重云（multi-cloud）")]),e._v(" "),t("li",[e._v("可扩展: 模块化, 插件化, 可挂载, 可组合")]),e._v(" "),t("li",[e._v("自动化: 自动部署，自动重启，自动复制，自动伸缩/扩展")])]),e._v(" "),t("h2",{attrs:{id:"部署步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署步骤"}},[e._v("#")]),e._v(" 部署步骤")]),e._v(" "),t("ol",[t("li",[e._v("在所有节点安装Docker和kubeadm")]),e._v(" "),t("li",[e._v("部署Kubernetes Master")]),e._v(" "),t("li",[e._v("部署容器网络插件")]),e._v(" "),t("li",[e._v("部署Kubernetes Node,将节点加入Kubernetes集群中")]),e._v(" "),t("li",[e._v("部署Dashboard Web 页面, 可视化查看Kubernetes资源")])]),e._v(" "),t("h2",{attrs:{id:"配置网络与前置环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置网络与前置环境"}},[e._v("#")]),e._v(" 配置网络与前置环境")]),e._v(" "),t("ol",[t("li",[e._v("使用vagrant up命令运行Vagrantfile文件")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('Vagrant.configure("2") do |config|\n   (1..3).each do |i|\n        config.vm.define "k8s-node#{i}" do |node|\n            # 设置虚拟机的Box\n            node.vm.box = "centos/7"\n\n            # 设置虚拟机的主机名\n            node.vm.hostname="k8s-node#{i}"\n\n            # 设置虚拟机的IP\n            node.vm.network "private_network", ip: "192.168.56.#{99+i}", netmask: "255.255.255.0"\n\n            # 设置主机与虚拟机的共享目录\n            # node.vm.synced_folder "~/Documents/vagrant/share", "/home/vagrant/share"\n\n            # VirtaulBox相关配置\n            node.vm.provider "virtualbox" do |v|\n                # 设置虚拟机的名称\n                v.name = "k8s-node#{i}"\n                # 设置虚拟机的内存大小\n                v.memory = 4096\n                # 设置虚拟机的CPU个数\n                v.cpus = 4\n            end\n        end\n   end\nend\n')])])]),t("ol",{attrs:{start:"2"}},[t("li",[e._v("切换root用户,设置密码访问")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("su root\nvi /etc/ssh/sshd_config\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[t("p",[e._v("设置NET网络\n"),t("a",{attrs:{title:"",href:"https://gj-blog.oss-cn-hangzhou.aliyuncs.com/blog-img/2022-10-27-JxViZK.png"}},[t("img",{attrs:{src:"https://gj-blog.oss-cn-hangzhou.aliyuncs.com/blog-img/2022-10-27-JxViZK.png",alt:""}})])])]),e._v(" "),t("li",[t("p",[e._v("关闭防火墙")])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl stop firewalld\nsystemctl disable firewalld\n")])])]),t("ol",{attrs:{start:"6"}},[t("li",[e._v("关闭selinux")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sed -i 's/enforcing/disabled/' /etc/selinux/config\n# 设置当前环境生效\nsetenforce 0  \n")])])]),t("ol",{attrs:{start:"7"}},[t("li",[e._v("关闭swap 内存交换")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("swapoff -a  #临时\nsed -ri 's/.*swap.*/#&/' /etc/fstab #永久\n")])])]),t("ol",{attrs:{start:"8"}},[t("li",[e._v("添加主机名与IP对应关系")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("vi /etc/hosts\n10.0.2.15 k8s-node1\n10.0.2.6  k8s-node2\n10.0.2.5  k8s-node3\n")])])]),t("ol",{attrs:{start:"9"}},[t("li",[e._v("将桥接的IPV4流量传递到iptables的链")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cat > /etc/sysctl.d/k8s.conf<<EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n# 应用配置\nsysctl --system\n")])])]),t("h2",{attrs:{id:"安装软件环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装软件环境"}},[e._v("#")]),e._v(" 安装软件环境")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("安装Docker")])]),e._v(" "),t("li",[t("p",[e._v("安装kubeadm,kubelet和kubectl")])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# 添加阿里云yum源\ncat > /etc/yum.repos.d/kubernetes.repo <<EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\nhttps://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("yum install -y kubelet-1.17.3 kubeadm-1.17.3 kubectl-1.17.3\n\n# 开机启动\nsystemctl enable kubelet\nsystemctl start kubelet\n\n# 启动 会失败\n# systemctl start kubelet\n# 查看状态\nsystemctl status kubelet\n")])])]),t("h2",{attrs:{id:"部署k8s-master"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署k8s-master"}},[e._v("#")]),e._v(" 部署k8s-master")]),e._v(" "),t("ol",[t("li",[e._v("下载docker镜像 执行master_image.sh文件")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("#!/bin/bash\n\nimages=(\n\tkube-apiserver:v1.17.3\n    kube-proxy:v1.17.3\n\tkube-controller-manager:v1.17.3\n\tkube-scheduler:v1.17.3\n\tcoredns:1.6.5\n\tetcd:3.4.3-0\n    pause:3.1\n)\n\nfor imageName in ${images[@]} ; do\n    docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName\n#   docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName  k8s.gcr.io/$imageName\ndone\n\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[e._v("master节点初始化")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubeadm init \\\n--apiserver-advertise-address=10.0.2.15 \\\n--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \\\n--kubernetes-version v1.17.3 \\\n--service-cidr=10.96.0.0/16 \\\n--pod-network-cidr=10.244.0.0/16\n\n# 重置\nkubeadm reset\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[e._v("运行生成的配置")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n")])])]),t("p",[e._v("保存生成的token")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubeadm join 10.0.2.15:6443 --token lml1wf.b3nzu1pabgsu9oxm \\\n    --discovery-token-ca-cert-hash sha256:54d248b7a8f8757a5344b0851f262d581372cd0a3be140dba9d4c2e3c83e5196 \n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[e._v("安装组件")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl apply -f kube-flannel.yml\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[t("p",[e._v("等着变成Running\n"),t("a",{attrs:{title:"",href:"https://gj-blog.oss-cn-hangzhou.aliyuncs.com/blog-img/2022-10-28-dWhxn6.png"}},[t("img",{attrs:{src:"https://gj-blog.oss-cn-hangzhou.aliyuncs.com/blog-img/2022-10-28-dWhxn6.png",alt:""}})])])]),e._v(" "),t("li",[t("p",[e._v("查看master状态")])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get  nodes\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);