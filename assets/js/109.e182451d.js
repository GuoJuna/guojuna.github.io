(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{518:function(a,t,s){"use strict";s.r(t);var e=s(0),l=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),t("p",[a._v("( 1 )首先, MySQL主库在事务提交时会把数据变更作为事件 Events 记录在二进制日志文件Binlog中; MySQL主库上的 sync_binlog参数控制 Binlog日志刷新到磁盘。")]),a._v(" "),t("p",[a._v("( 2 )主库推送二进制日志文件 Binlog中的事件到从库的中继日志 Relay Log, 之后从库根据中继日志 Relay Log重做数据变更操作, 通过逻辑复制以此来达到主库和从库的数据一致。")]),a._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),t("ol",[t("li",[a._v("创建Master实例并启动")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker run -p 3307:3306 --name mysql-master \\\n-v /mydata/mysql/master/log:/var/log/mysql \\\n-v /mydata/mysql/master/data:/var/lib/mysql \\\n-v /mydata/mysql/master/conf:/etc/mysql \\\n-e MYSQL_ROOT_PASSWORD=root \\\n-d mysql:5.7\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("创建Slave实例并启动")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker run -p 3317:3306 --name mysql-slaver \\\n-v /mydata/mysql/slaver/log:/var/log/mysql \\\n-v /mydata/mysql/slaver/data:/var/lib/mysql \\\n-v /mydata/mysql/slaver/conf:/etc/mysql \\\n-e MYSQL_ROOT_PASSWORD=root \\\n-d mysql:5.7\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("给master和slaver添加基本配置")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vi /mydata/mysql/master/conf/my.cnf\n\nvi /mydata/mysql/slaver/conf/my.cnf\n")])])]),t("p",[a._v("分别添加如下配置")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("[client]\ndefault-character-set=utf8\n[mysql]\ndefault-character-set=utf8\n[mysqld]\ninit_connect='SET collation_connection = utf8_unicode_ci'\ninit_connect='SET NAMES utf8'\ncharacter-set-server=utf8\ncollation-server=utf8_unicode_ci\nskip-character-set-client-handshake\nskip-name-resolve\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[a._v("Master配置 my.cnf添加如下配置")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 主从复制配置如下\n\n#主服务器唯一Id[必填]\nserver-id=1\n#启用二进制日志[必填] mysql-bin日志文件名\nlog-bin=mysql-bin \n#主机，读写都可以\nread-only=0\n#设置不要复制的数据库[可选]\n#binlog-ignore-db=mysql\n#设置需要复制的数据库[可选]（输数据库名字） \nbinlog-do-db=test\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[a._v("Salve配置 my.cnf添加如下配置")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("#主从复制配置\n#从服务器唯一Id\nserver-id=2\n#只读，对拥有super权限的账号是不生效的\nread_only = 1\n#启用二进制日志\nlog-bin=mysql-bin \n")])])]),t("ol",{attrs:{start:"6"}},[t("li",[a._v("为master授权用户用来同步数据")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 进入master容器\ndocer exec -it mysql /bin/bash\n# 添加用来同步的用户 \nGRANT REPLICATION SLAVE ON *.* TO 'backup'@'%' IDENTIFIED BY '123456';\n# 查看master的状态 查询日志文件\nshow master status\n")])])]),t("ol",{attrs:{start:"7"}},[t("li",[a._v("配置slaver")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("CHANGE MASTER TO MASTER_HOST='192.168.56.20', MASTER_PORT=3307, MASTER_USER='backup', MASTER_PASSWORD='123456', MASTER_LOG_FILE='mysql-bin.000002', MASTER_LOG_POS=3052;\n")])])]),t("ol",{attrs:{start:"8"}},[t("li",[a._v("启动从服务器复制功能")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("start slave\n")])])]),t("ol",{attrs:{start:"9"}},[t("li",[a._v("查看是否成功")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("show slave status\\G\n#【\\G是为了以键值的形式显示，好看一些】\n#下面两个参数都是Yes，则说明主从配置成功！\n")])])]),t("p",[t("a",{attrs:{title:"",href:"https://gj-blog.oss-cn-hangzhou.aliyuncs.com/blog-img/2022-10-21-2l8a6M.png"}},[t("img",{attrs:{src:"https://gj-blog.oss-cn-hangzhou.aliyuncs.com/blog-img/2022-10-21-2l8a6M.png",alt:""}})])])])}),[],!1,null,null,null);t.default=l.exports}}]);